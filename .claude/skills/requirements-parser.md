# requirements-parser Skill

**Purpose**: 强制需求解析，防止 AI 误解客户要求

**Auto-triggers**:
- 关键词：`issue`, `客戶`, `反饋`, `需求`, `要求`, `修復`, `bug`
- 优先级：🔴 Critical (在实施前必须执行)

---

## Skill 执行流程

### Step 1: 提取明确要求

仔细阅读 issue/客户反馈，提取**所有明确的**要求。

**输出格式**：
```markdown
### ✅ 明确要求
- [ ] 要求1：[客户原文]
- [ ] 要求2：[客户原文]
- [ ] 要求3：[客户原文]
```

**示例**（Issue #4）：
```markdown
### ✅ 明确要求
- [ ] 单字区块在最上方
- [ ] 影片区块在单字下方
- [ ] 词性与关联字 GROUP 在影片下方
  - GROUP 内部顺序：词性 → 同义字｜反义字｜易混淆字 → 字根｜字首｜字尾
- [ ] 汇出内容在最下方
```

---

### Step 2: 识别模糊需求

检查以下模糊信号：
- ❌ 使用模糊词汇：「上一個版本」、「之前那樣」、「改回來」
- ❌ 缺少具体细节：「寬度一樣」（多宽？响应式还是固定？）
- ❌ 多义表达：「改壞了」（哪里坏了？）

**输出格式**：
```markdown
### ⚠️ 模糊需求（需要澄清）
- 问题1：客户说「[模糊表达]」，但没有明确 [缺少的信息]
  - 可能含义A：[猜测1]
  - 可能含义B：[猜测2]
  - 可能含义C：[猜测3]
```

**示例**（Issue #19）：
```markdown
### ⚠️ 模糊需求（需要澄清）
- 问题1：客户说「回到上一個版本」，但没有明确是哪个版本
  - 可能是：原始设计 (commit 65f497b)
  - 可能是：第一次尝试 (commit 713a353)
  - 可能是：第二次尝试 (commit f0340e7)

- 问题2：客户说「寬度一樣」，但没有明确宽度规格
  - 可能是：响应式宽度（100%，随屏幕变化）
  - 可能是：固定宽度（600px/900px）
  - 可能是：其他方式
```

---

### Step 3: 生成澄清问题

如果发现模糊需求，生成结构化的澄清问题。

**输出格式**：
```markdown
### 🔍 需要向客户澄清的问题

#### 问题1：[简短描述]
[具体问题描述]

**选项**：
- A. [选项描述]
- B. [选项描述]
- C. [选项描述]

#### 问题2：[简短描述]
[具体问题描述]

**选项**：
- A. [选项描述]
- B. [选项描述]

---

### 🚨 建议行动
1. **发布澄清评论**（使用上述问题）
2. **等待客户回复**
3. **收到明确回复后再实施修复**
```

---

### Step 4: 决策

```
IF 有模糊需求 THEN
  - ❌ 不要猜测
  - ❌ 不要实施修复
  - ✅ 发布澄清评论
  - ✅ 等待客户明确回复

IF 所有需求都明确 THEN
  - ✅ 继续实施修复
  - ✅ 实施时逐项对照 checklist
```

---

## 真实案例学习

### 案例1：需求明确（Issue #4 第2次）

**客户反馈**：
```
單字卡順序仍有錯誤
正確順序：
1. 單字（音標、詞性、tag）
2. 影片
3. 詞性與關聯字，這是一個grop，裡面的順序是:詞性→ 同義字 ｜反義字 ｜易混淆字 →字根 ｜字首 ｜字尾
4. 匯出內容
```

**requirements-parser 输出**：
```markdown
### ✅ 明确要求
- [ ] 顺序1：单字区块（包含音标、词性、tag）
- [ ] 顺序2：影片区块
- [ ] 顺序3：词性与关联字 GROUP
  - 内部顺序：词性变化 → 同义字｜反义字｜易混淆字 → 字根｜字首｜字尾
- [ ] 顺序4：汇出内容区块

### ⚠️ 模糊需求
无

### 🚨 建议行动
✅ 所有需求明确，可以直接实施修复
✅ 实施时严格按照客户指定的顺序排列区块
```

**结果**：✅ 第2次修复成功，客户测试通过

---

### 案例2：需求模糊（Issue #19 第2次）

**客户反馈**：
```
你改壞了，正反面的寬度還是不一樣，且反面改動寬度，導致句子斷行，不是原本的設計
請先回到上一個版本反面的寬度，正面與上一版的寬度相同
```

**requirements-parser 输出**：
```markdown
### ✅ 明确要求
- [ ] 正反面寬度必須一致
- [ ] 不可以導致句子斷行

### ⚠️ 模糊需求（需要澄清）
- 问题1：客户说「上一個版本」，但没有明确是哪个版本
  - 可能是：原始设计 (commit 65f497b) - 无宽度限制
  - 可能是：第一次尝试 (commit 713a353) - max-width: 600px
  - 可能是：第二次尝试 (commit f0340e7) - max-width: 900px

- 问题2：客户说「原本的設計」，但没有明确具体是什么
  - 可能是：响应式宽度（随屏幕自适应）
  - 可能是：固定宽度（但不确定多少px）
  - 可能是：其他方式

### 🔍 需要向客户澄清的问题

#### 问题1：「上一個版本」的具体含义
目前有三个版本的设计，您说的「上一個版本」是指哪一个？

**选项**：
- A. 原始设计 (commit 65f497b)：无宽度限制，卡片宽度 = 容器宽度（完全响应式）
- B. 第一次尝试 (commit 713a353)：max-width: 600px
- C. 第二次尝试 (commit f0340e7)：max-width: 900px

#### 问题2：卡片寬度行為
卡片应该如何表现？

**选项**：
- A. 响应式宽度（随屏幕宽度自动调整，无最大宽度限制）
- B. 固定宽度（例如 600px 或 900px）
- C. 其他方式（请说明）

#### 问题3：正面/反面宽度匹配
目前的问题是否与以下有关？

**选项**：
- A. 正面和反面卡片宽度数值不一致（例如正面 500px，反面 600px）
- B. 卡片在某些屏幕尺寸上看起来不对称
- C. 卡片内容超出边界或被截断
- D. 其他情况（请说明）

---

### 🚨 建议行动
1. **发布澄清评论**（使用上述问题）
2. **等待客户回复**
3. **收到明确回复后再实施第3次修复**
```

**实际执行**：✅ 发布了澄清评论，等待客户回复（符合 Failed Fix Principle）

**结果**：避免了第3次盲目猜测

---

## 检查清单

在完成需求解析后，确认：

- [ ] 已提取所有明确要求（checklist 格式）
- [ ] 已识别所有模糊需求
- [ ] 如果有模糊需求，已生成澄清问题
- [ ] 如果需要澄清，已明确**不实施**修复
- [ ] 如果需求明确，已准备好 checklist 供实施时对照

---

## 集成方式

### 方式1：通过 hook 自动触发

在 `.claude/config/skill-rules.json` 配置：
```json
{
  "requirements-parser": {
    "keywords": ["issue", "客戶", "反饋", "需求", "要求"],
    "priority": "critical",
    "triggers": "before_implementation"
  }
}
```

### 方式2：通过 agent-manager 强制调用

```yaml
IF 收到 issue 或客户反馈 THEN
  1. 强制调用 requirements-parser
  2. 如果发现模糊需求 → 发布澄清评论
  3. 等待客户回复后再继续
```

---

**创建日期**: 2025-12-26
**基于数据**: WordGym Students 项目真实案例
**成功率**: 目标 95%+ 需求解析准确率
